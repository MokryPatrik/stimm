syntax = "proto3";

package voicebot.tts.v1;

option go_package = "voicebot/tts/v1;ttsv1";
option java_multiple_files = true;
option java_package = "ai.voicebot.tts.v1";

// SynthesisStreamRequest sends either the stream configuration or a text chunk.
message SynthesisStreamRequest {
  string request_id = 1;

  oneof payload {
    SynthesisConfig config = 2;
    SynthesisChunk chunk = 3;
    ControlMessage control = 4;
  }
}

// Immutable synthesis settings associated with a stream instance.
message SynthesisConfig {
  string voice_name = 1;
  string language_code = 2;
  uint32 sample_rate_hz = 3;
  map<string, string> metadata = 4;
}

// A piece of text fed into the synthesizer.
message SynthesisChunk {
  string text = 1;
  bool is_final = 2;
  uint32 sequence = 3;
}

// Control information to coordinate the duplex stream.
message ControlMessage {
  enum Type {
    TYPE_UNSPECIFIED = 0;
    TYPE_FLUSH = 1;
    TYPE_CANCEL = 2;
  }

  Type type = 1;
}

// Audio payload emitted by providers. Downstream clients can start playback
// as soon as they receive the first non-empty chunk.
message AudioChunk {
  bytes data = 1;
  uint32 sample_rate_hz = 2;
  uint32 num_channels = 3;
  uint32 sequence = 4;
  bool is_last = 5;
  uint32 timestamp_ms = 6;
  map<string, string> metadata = 7;
}

service StreamingTts {
  // Bidirectional streaming RPC for low-latency synthesis.
  // Clients send one SynthesisConfig followed by 0..n SynthesisChunks and
  // optional control messages. The service emits AudioChunks as soon as audio
  // frames are produced.
  rpc Synthesize(stream SynthesisStreamRequest) returns (stream AudioChunk);
}
